<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Minhas ConfiguraÃ§Ãµes - JorgeBot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav id="navbar"></nav>
    <div class="admin-container" style="max-width: 800px;">
        <div class="admin-header"><h1>ðŸŽ¨ Personalize seu Bot</h1></div>
        <div class="admin-content" style="grid-template-columns: 1fr;">
            <div class="system-instruction-area">
                <h3>Sua Personalidade Customizada</h3>
                <textarea id="custom-instruction-textarea" placeholder="Ex: VocÃª Ã© um pirata..."></textarea>
                <button id="save-custom-btn" class="btn">ðŸ’¾ Salvar</button>
                <div id="settings-status" class="hidden"></div>
            </div>
        </div>
    </div>
    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('token')) window.location.href = 'login.html';

            const instructionTextarea = document.getElementById('custom-instruction-textarea');
            const saveBtn = document.getElementById('save-custom-btn');
            const statusDiv = document.getElementById('settings-status');
            const token = localStorage.getItem('token');

            // Carregar instruÃ§Ã£o
            fetch('https://chatbot-liau.onrender.com/api/user/preferences', { headers: { 'Authorization': `Bearer ${token}` }})
                .then(res => res.json())
                .then(data => instructionTextarea.value = data.instruction);

            // Salvar instruÃ§Ã£o
            saveBtn.addEventListener('click', async () => {
                const res = await fetch('https://chatbot-liau.onrender.com/api/user/preferences', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
                    body: JSON.stringify({ instruction: instructionTextarea.value })
                });
                const data = await res.json();
                statusDiv.textContent = data.message;
                statusDiv.className = res.ok ? 'status-message status-success' : 'status-message status-error';
            });
        });
    </script>
</body>
</html>
